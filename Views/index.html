<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Freundin Status Panel</title>
  <meta name="theme-color" content="#fbcfe8" />
  <style>
    :root{
      --bg:#fdf2f8;
      --card:#ffffffcc;
      --muted:#6b7280;
      --text:#3f3f46;
      --accent:#a5b4fc;
      --accent2:#f9a8d4;
      --ok:#86efac;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: linear-gradient(135deg,#fdf2f8,#e0f2fe);
      color:var(--text);
      padding:16px;
    }
    .wrap{
      max-width:560px;
      margin:0 auto;
      padding-bottom:120px;
    }
    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:14px;
    }
    h1{
      margin:0;
      font-size:22px;
    }
    .subhead{
      font-size:13px;
      color:var(--muted);
      margin-top:4px;
    }
    .chip{
      background:#fff;
      border-radius:999px;
      padding:8px 12px;
      font-size:12px;
      box-shadow:var(--shadow);
      color:var(--muted);
    }
    .card{
      background:var(--card);
      backdrop-filter: blur(6px);
      border-radius:var(--radius);
      padding:14px;
      margin:12px 0;
      box-shadow:var(--shadow);
    }
    .row{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .label{font-weight:600;font-size:14px}
    .sub{font-size:12px;color:var(--muted)}
    .val{
      background:#f3f4f6;
      padding:6px 10px;
      border-radius:999px;
      font-size:13px;
      min-width:56px;
      text-align:center;
    }
    .slider{
      width:100%;
      margin:10px 0 4px;
      appearance:none;
      height:10px;
      border-radius:999px;
      background:#e5e7eb;
    }
    .slider::-webkit-slider-thumb{
      appearance:none;
      width:22px;
      height:22px;
      border-radius:50%;
      background:var(--accent2);
      cursor:pointer;
      box-shadow:0 4px 10px rgba(0,0,0,.15);
    }
    .hint{
      display:flex;
      justify-content:space-between;
      font-size:12px;
      color:var(--muted);
    }
    .summary{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .pill{
      background:#f9fafb;
      padding:10px;
      border-radius:14px;
    }
    .pill .k{font-size:12px;color:var(--muted)}
    .pill .v{font-weight:700}
    .bf{
      margin-top:10px;
      padding:10px;
      background:#fff0f6;
      border-radius:14px;
      font-size:13px;
    }
    .sendbar{
      position:fixed;
      bottom:0;
      left:0;
      right:0;
      padding:12px 16px;
      background:linear-gradient(to top,#fdf2f8,transparent);
    }
    .sendwrap{
      max-width:560px;
      margin:0 auto;
      display:flex;
      gap:10px;
      align-items:center;
    }
    button{
      flex:1;
      padding:14px;
      border:0;
      border-radius:14px;
      font-weight:700;
      font-size:15px;
      background:linear-gradient(135deg,var(--accent2),var(--accent));
      color:white;
      box-shadow:0 8px 20px rgba(0,0,0,.12);
    }
    .status{font-size:12px;color:var(--muted);min-width:100px;text-align:right}
	.aff-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
  margin-top:14px;
}

	.aff-square{
	  aspect-ratio: 1 / 1;
	  border-radius:18px;
	  border:2px solid transparent;
	  background:#fce7f3;
	  display:flex;
	  flex-direction:column;
	  align-items:center;
	  justify-content:center;
	  gap:8px;
	  cursor:pointer;
	  transition: all .2s ease;
	  box-shadow: 0 8px 18px rgba(0,0,0,.06);
	}

	.aff-square:hover{
	  transform: translateY(-3px);
	}

	.aff-square .emoji{
	  font-size:48px;
	  line-height:1;
	}

	.aff-square .txt{
	  font-size:13px;
	  font-weight:600;
	  color:#9d174d;
	}

	.aff-square.active{
	  background: linear-gradient(135deg,#f9a8d4,#a5b4fc);
	  border-color:white;
	}

	.aff-square.active .txt{
	  color:white;
	}

	.aff-status{
	  margin-top:12px;
	  font-size:13px;
	  color:#6b7280;
		}
	.aff-scroll{
	  display:flex;
	  gap:14px;
	  margin-top:14px;
	  padding: 2px 2px 10px;
	  overflow-x:auto;
	  -webkit-overflow-scrolling: touch;
	  scroll-snap-type: x mandatory;
	}

	.aff-scroll::-webkit-scrollbar{
	  height:8px;
	}
	.aff-scroll::-webkit-scrollbar-thumb{
	  background: rgba(0,0,0,.12);
	  border-radius: 999px;
	}

	.aff-square{
	  flex: 0 0 auto;
	  width: 120px;
	  aspect-ratio: 1 / 1;
	  border-radius:18px;
	  border:2px solid transparent;
	  background:#fce7f3;
	  display:flex;
	  flex-direction:column;
	  align-items:center;
	  justify-content:center;
	  gap:8px;
	  cursor:pointer;
	  transition: all .2s ease;
	  box-shadow: 0 8px 18px rgba(0,0,0,.06);
	  scroll-snap-align: start;
	}

	.aff-square:hover{
	  transform: translateY(-3px);
	}

	.aff-square .emoji{
	  font-size:48px;
	  line-height:1;
	}

	.aff-square .txt{
	  font-size:13px;
	  font-weight:600;
	  color:#9d174d;
	  text-align:center;
	  padding: 0 6px;
	}

	.aff-square.active{
	  background: linear-gradient(135deg,#f9a8d4,#a5b4fc);
	  border-color:white;
	}

	.aff-square.active .txt{
	  color:white;
	}


  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Freundin Status Panel</h1>
        <div class="subhead">Schieben. Senden. Freund wird informiert ğŸ’Œ</div>
      </div>
      <div class="chip" id="lastSent">Zuletzt gesendet: nie</div>
    </header>

    <!-- SLIDERS -->
    <div class="card">
      <div class="row">
        <div>
          <div class="label">Stimmung ğŸ˜„ğŸ˜ˆ</div>
          <div class="sub">0 = Drama, 100 = Engel</div>
        </div>
        <div class="val" id="moodVal">50</div>
      </div>
      <input class="slider" id="mood" type="range" min="0" max="100" value="50"/>
      <div class="hint"><span>ğŸ˜ˆ</span><span>ğŸ˜‡</span></div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div class="label">Hunger ğŸ•</div>
          <div class="sub">0 = satt, 100 = sofort Essen</div>
        </div>
        <div class="val" id="hungerVal">40</div>
      </div>
      <input class="slider" id="hunger" type="range" min="0" max="100" value="40"/>
      <div class="hint"><span>ğŸ¥—</span><span>ğŸ”</span></div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div class="label">Energie ğŸ”‹</div>
          <div class="sub">0 = mÃ¼de, 100 = Power</div>
        </div>
        <div class="val" id="energyVal">55</div>
      </div>
      <input class="slider" id="energy" type="range" min="0" max="100" value="55"/>
      <div class="hint"><span>ğŸ˜´</span><span>âš¡</span></div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div class="label">Stress ğŸ˜µâ€ğŸ’«</div>
          <div class="sub">0 = entspannt, 100 = Ausnahmezustand</div>
        </div>
        <div class="val" id="stressVal">25</div>
      </div>
      <input class="slider" id="stress" type="range" min="0" max="100" value="25"/>
      <div class="hint"><span>ğŸ§˜</span><span>ğŸ”¥</span></div>
    </div>

	<div class="aff-scroll" id="needBar">
	  <button type="button" class="aff-square" data-need="cuddle">
		<div class="emoji">ğŸ§¸</div>
		<div class="txt">Kuscheln</div>
	  </button>

	  <button type="button" class="aff-square" data-need="kiss">
		<div class="emoji">ğŸ’‹</div>
		<div class="txt">Kuss</div>
	  </button>

	  <button type="button" class="aff-square" data-need="message">
		<div class="emoji">ğŸ’¬</div>
		<div class="txt">Schreib mir</div>
	  </button>

	  <button type="button" class="aff-square" data-need="call">
		<div class="emoji">ğŸ“</div>
		<div class="txt">Anrufen</div>
	  </button>

	  <button type="button" class="aff-square" data-need="food">
		<div class="emoji">ğŸ”</div>
		<div class="txt">Essen</div>
	  </button>
	</div>

	<div id="affectionStatus" class="aff-status">
	  Keine akuten Anforderungen gemeldet.
	</div>




    <!-- SUMMARY -->
    <div class="card">
      <div class="summary">
        <div class="pill"><div class="k">Stimmung</div><div class="v" id="sumMood"></div></div>
        <div class="pill"><div class="k">Hunger</div><div class="v" id="sumHunger"></div></div>
        <div class="pill"><div class="k">Energie</div><div class="v" id="sumEnergy"></div></div>
        <div class="pill"><div class="k">Stress</div><div class="v" id="sumStress"></div></div>
        <div class="pill"><div class="k">Needs</div><div class="v" id="sumNeeds">keine</div></div>
        <div class="pill"><div class="k">Freund Aktion</div><div class="v" id="sumAction"></div></div>
      </div>
      <div class="bf" id="bfLine">Freund System wird vorbereitetâ€¦</div>
    </div>
  </div>

  <div class="sendbar">
    <div class="sendwrap">
      <button id="sendBtn">Status senden ğŸ’Œ</button>
      <div class="status" id="sendStatus">Bereit</div>
    </div>
  </div>

  <script>
  const needs = new Set();

const needButtons = document.querySelectorAll("#needBar .aff-square");
const affectionStatus = document.getElementById("affectionStatus");

function labelForNeed(key){
  const map = {
    cuddle: "ğŸ§¸ Kuscheln",
    kiss: "ğŸ’‹ Kuss",
    message: "ğŸ’¬ Nachricht",
    call: "ğŸ“ Anruf",
    food: "ğŸ” Essen"
  };
  return map[key] || key;
}

function updateNeedsText(){
  if(needs.size === 0){
    affectionStatus.textContent = "Keine akuten Anforderungen gemeldet.";
    return;
  }
  const items = [...needs].map(labelForNeed).join(" + ");
  affectionStatus.textContent = "Angefordert: " + items;
}

function needsSummaryText(){
  if (needs.size === 0) return "keine";
  return [...needs].map(labelForNeed).join(" + ");
}

needButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const key = btn.dataset.need;
    if(needs.has(key)){
      needs.delete(key);
      btn.classList.remove("active");
    }else{
      needs.add(key);
      btn.classList.add("active");
    }
    updateNeedsText();

    // Optional: keep your summary/action in sync
    render();
  });
});

updateNeedsText();


    const el=id=>document.getElementById(id);
    const sliders=["mood","hunger","energy","stress"];

    function txt(v,a,b,c,d){if(v<25)return a;if(v<50)return b;if(v<75)return c;return d}

    function render(){
      const mood=+el("mood").value;
      const hunger=+el("hunger").value;
      const energy=+el("energy").value;
      const stress=+el("stress").value;

      el("moodVal").textContent=mood;
      el("hungerVal").textContent=hunger;
      el("energyVal").textContent=energy;
      el("stressVal").textContent=stress;

      el("sumMood").textContent=txt(mood,"Drama","Meh","Gut drauf","Engel");
      el("sumHunger").textContent=txt(hunger,"Satt","Snack bald","Hungrig","SOFORT ESSEN");
      el("sumEnergy").textContent=txt(energy,"Schlafmodus","MÃ¼de","Okay","Power");
      el("sumStress").textContent=txt(stress,"Zen","Leicht gestresst","Gestresst","ALARM");
	  el("sumNeeds").textContent = needsSummaryText();

      let action="Bereitschaft halten";
      if(hunger>80)action="Essen organisieren";
      else if(stress>80)action="Beruhigen + Umarmen";
      else if(mood<20)action="Sehr lieb sein";

      el("sumAction").textContent=action;
      el("bfLine").textContent="Freund Protokoll: "+action;
    }

    sliders.forEach(s=>el(s).addEventListener("input",render));
    render();
	const sendBtn = document.getElementById("sendBtn");
	const sendStatusEl = document.getElementById("sendStatus");
	const lastSentEl = document.getElementById("lastSent");

	async function sendStatus(){
	  sendBtn.disabled = true;
	  sendStatusEl.textContent = "Sendenâ€¦";

	  const payload = {
		mood: +el("mood").value,
		hunger: +el("hunger").value,
		energy: +el("energy").value,
		stress: +el("stress").value,
		needs: [...needs].map(x => x), // array
		note: null
	  };

	  try{
		<!-- const res = await fetch("/api/status", { -->
		const res = await fetch("http://localhost:7010/api/status", {
		  method: "POST",
		  headers: { "Content-Type": "application/json" },
		  body: JSON.stringify(payload)
		});

		if(!res.ok){
		  const t = await res.text().catch(() => "");
		  throw new Error(`HTTP ${res.status} ${t}`.trim());
		}

		const now = new Date();
		lastSentEl.textContent = "Zuletzt gesendet: " + now.toLocaleString();
		sendStatusEl.textContent = "Gesendet âœ…";
		setTimeout(() => sendStatusEl.textContent = "Bereit", 1500);
	  }catch(err){
		console.error(err);
		sendStatusEl.textContent = "Fehler âŒ";
		alert("Senden fehlgeschlagen. Ist /api/status erreichbar?");
		setTimeout(() => sendStatusEl.textContent = "Bereit", 2000);
	  }finally{
		sendBtn.disabled = false;
	  }
	}

	sendBtn.addEventListener("click", sendStatus);

  </script>
</body>
</html>
